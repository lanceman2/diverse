#! /bin/sh

########################################################################
# This block was taken from Daniel Elstner's autogen.sh.
########################################################################
dir=`echo "$0" | sed 's,[^/]*$,,'`
test "x${dir}" = "x" && dir='.'
if test "x`cd "${dir}" 2>/dev/null && pwd`" != "x`pwd`"
then
    echo "This script ($0) must be executed directly from the top $0 source directory."
    exit 1
fi
# end taken from Daniel Elstner
########################################################################

if [ "$1" == "" ]
then
  echo "Usage: $0 OUTFILE"
  exit 1
fi


programs="`find ../config ../programs ../server \
 -name 'dtk-*' -perm -0100 -print | \
 grep -v '/.libs/' | grep -v '\.app$' | grep -v '\.app/' | grep -v 'CMakeFiles'`"

cwd=`pwd`

fullfile=""
if [[ $fullfile == /* ]]; then
  fullfile=$1
else
  fullfile="$cwd/$1"
fi

echo $fullfile

count=0
for i in $programs
do
  count=`expr $count + 1`
done

if [ $count = 0 ]
then
  echo "No DTK programs built.  Run \`make' in .. before this."
  exit 1
elif [ $count -lt 20 ]
then
  topsrc="`pwd`"
  topsrc="`dirname $topsrc`"
  echo "All the DTK programs are not built (only $count).&nbsp;  Run \`make' in \`${topsrc}' before this."
  exit 1
fi



printf "\
<html>
<head>
<title>Help for All DTK Programs</title>
</head>
<body>

<center>
<h2>Help for All DTK Programs</h2>
</center>

Here we list the output of the '--help' (or '-h') for
$count DTK programs.&nbsp;  Note: some of this output depends on where DTK
programs are installed when this page was generated.&nbsp;  This document
was generated by running all these DTK programs on a `uname` system using
DTK version `../config/dtk-config --version`, `../config/dtk-config --date`.
<p> 

All of these programs are Licensed
under the GNU General Public License, except for dtk-server which is
Licensed under the GNU Lesser General Public License.
See: http://www.gnu.org/copyleft/.

<p>
" > $fullfile


for i in $programs
do
   basename="`basename $i`"
   dirname="`dirname $i`"
   echo "<hr>" >> $fullfile
   echo "output of: <b>$basename --help</b>" >> $fullfile
   echo "<p>" >> $fullfile
   echo "<pre>" >> $fullfile
   echo running $i --help
   cd $dirname
   if [ "$basename" != "dtk-checkColor" ]
   then
     ./$basename --help >> $fullfile
   else
     ./$basename --help | sed -e 's/</\&lt;/g' -e 's/>/\&gt;/g' >> $fullfile
   fi
   cd $cwd
   echo "</pre>" >> $fullfile
done

echo "<p>" >> $fullfile
echo >> $fullfile

cat footer.html >> $fullfile

echo "made $1 from the output of the ----- $count DTK programs ------"
