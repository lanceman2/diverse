# CMakeLists.txt to build doxygen docs

IF (DTK_BUILD_DOCUMENTATION)
	IF (DOXYGEN_DOT_PATH)
		SET (DOT_PATH "${DOXYGEN_DOT_PATH}")
		IF (WIN32)
			STRING (REPLACE "/" "\\\\" DOT_PATH "${DOT_PATH}")
		ENDIF (WIN32)
	ENDIF (DOXYGEN_DOT_PATH)

	SET (DTK_SOURCE_INCLUDES_PATH ${DTK_SOURCE_DIR}/include)
	SET (DTK_SOURCE_EXAMPLES_PATH ${DTK_SOURCE_DIR}/examples)
	SET (DTK_DOXYGEN_OUTPUT_PATH ${DTK_BINARY_DIR}/doc)
	SET (DTK_DOXYGEN_HTML_OUTPUT "html/classes")
	SET (DTK_DOXYGEN_FOOTER ${DTK_BINARY_DIR}/doc/footer.html)

	FILE (REMOVE_RECURSE ${DTK_DOXYGEN_OUTPUT_PATH}/man)
	FILE (MAKE_DIRECTORY ${DTK_DOXYGEN_OUTPUT_PATH}/man)
	FILE (REMOVE_RECURSE ${DTK_DOXYGEN_OUTPUT_PATH}/html)
	FILE (MAKE_DIRECTORY ${DTK_DOXYGEN_OUTPUT_PATH}/html)

	IF (DOXYGEN_EXECUTABLE)
		SET (DTK_DOXYGEN_LINK "<a href=\"classes/main.html\">Doxygen docs</a>")
		SET (DTK_DOXYGEN_FRAMES "<a href=\"classes/index.html\">Doxygen docs with frames</a>")
	ELSE (DOXYGEN_EXECUTABLE)
		SET (DTK_DOXYGEN_LINK "")
		SET (DTK_DOXYGEN_FRAMES "")
	ENDIF (DOXYGEN_EXECUTABLE)

	IF (WIN32)
		STRING (REPLACE "/" "\\\\" DTK_SOURCE_INCLUDES_PATH "${DTK_SOURCE_INCLUDES_PATH}")
		STRING (REPLACE "/" "\\\\" DTK_SOURCE_EXAMPLES_PATH "${DTK_SOURCE_EXAMPLES_PATH}")
		STRING (REPLACE "/" "\\\\" DTK_DOXYGEN_OUTPUT_PATH "${DTK_DOXYGEN_OUTPUT_PATH}")
		STRING (REPLACE "/" "\\\\" DTK_DOXYGEN_HTML_OUTPUT "${DTK_DOXYGEN_HTML_OUTPUT}")
		STRING (REPLACE "/" "\\\\" DTK_DOXYGEN_FOOTER "${DTK_DOXYGEN_FOOTER}")
		SET (DOXYGEN_WINDOWS_ENCODING YES)
	ELSE (WIN32)
		SET (DOXYGEN_WINDOWS_ENCODING NO)
	ENDIF (WIN32)

	IF (DOXYGEN_DOT_EXECUTABLE AND DOXYGEN_EXECUTABLE)
		SET (DTK_WITH_DOT "YES")
	ELSE (DOXYGEN_DOT_EXECUTABLE AND DOXYGEN_EXECUTABLE)
		SET (DTK_WITH_DOT "NO")
	ENDIF (DOXYGEN_DOT_EXECUTABLE AND DOXYGEN_EXECUTABLE)

	FOREACH (FILE_CUR Doxyfile footer.html)
		CONFIGURE_FILE (${DTK_SOURCE_DIR}/doc/${FILE_CUR}.in
			${DTK_DOXYGEN_OUTPUT_PATH}/${FILE_CUR} @ONLY)
	ENDFOREACH (FILE_CUR)
	FILE (READ ${DTK_BINARY_DIR}/doc/footer.html DTK_FOOTER)
	FOREACH (FILE_CUR MSWindowsNotes.html directives.html downloads.html
		gui_pictures.html index.html tutor_CPP_DSO_loading.html
		tutor_intro.html tutor_programming.html tutor_programs.html
		tutor_realtime.html tutor_toc.html )
		CONFIGURE_FILE (${DTK_SOURCE_DIR}/doc/${FILE_CUR}.in
			${DTK_DOXYGEN_OUTPUT_PATH}/html/${FILE_CUR} @ONLY)
		FILE (APPEND ${DTK_DOXYGEN_OUTPUT_PATH}/html/${FILE_CUR} ${DTK_FOOTER})
	ENDFOREACH (FILE_CUR)

	IF (WIN32)
		SET (PROG_HELP_SCRIPT allProgramsHelp.bat)
		SET (INSTALLATION_SCRIPT installation.bat)
	ELSE (WIN32)
		SET (PROG_HELP_SCRIPT allProgramsHelp.sh)
		SET (INSTALLATION_SCRIPT installation.sh)
	ENDIF (WIN32)

	CONFIGURE_FILE (${PROG_HELP_SCRIPT} ${DTK_DOXYGEN_OUTPUT_PATH}/${PROG_HELP_SCRIPT} @ONLY)

	FILE (TO_NATIVE_PATH ${DTK_SOURCE_DIR} DTK_SRC_DIR)
	CONFIGURE_FILE (${INSTALLATION_SCRIPT}
		${DTK_DOXYGEN_OUTPUT_PATH}/${INSTALLATION_SCRIPT} @ONLY)

	IF (DTK_ARCH_UPPER MATCHES "WIN32_VCPP")
		SET(PATH_SAVE $ENV{PATH})
		FILE (TO_NATIVE_PATH ${DTK_BINARY_DIR} DTK_BIN_DIR)
		ADD_CUSTOM_TARGET (doc_programs ALL COMMAND set PATH=${DTK_BIN_DIR}\\lib\\dtk\;${DTK_BIN_DIR}\\lib\\dtkFLTK\;${DTK_BIN_DIR}\\lib\\dtkGLX\;${DTK_BIN_DIR}\\lib\\dtkX11\;${DTK_BIN_DIR}\\server COMMAND ${PROG_HELP_SCRIPT} html\\listProgramsHelp.html COMMAND set PATH=${PATH_SAVE} )
	ELSEIF (DTK_ARCH_UPPER MATCHES "DARWIN")
		SET(DYLD_LIBRARY_PATH_SAVE $ENV{DYLD_LIBRARY_PATH})
		ADD_CUSTOM_TARGET (doc_programs ALL COMMAND export DYLD_LIBRARY_PATH=${DTK_BINARY_DIR}/lib/dtk:${DTK_BINARY_DIR}/lib/dtkFLTK:${DTK_BINARY_DIR}/lib/dtkGLX:${DTK_BINARY_DIR}/lib/dtkX11:${DTK_BINARY_DIR}/server && ./${PROG_HELP_SCRIPT} html/listProgramsHelp.html COMMAND export DYLD_LIBRARY_PATH=${DYLD_LIBRARY_PATH_SAVE})
	ELSE (DTK_ARCH_UPPER MATCHES "WIN32_VCPP")
		SET(LD_LIBRARY_PATH_SAVE $ENV{LD_LIBRARY_PATH})
		ADD_CUSTOM_TARGET (doc_programs ALL COMMAND export LD_LIBRARY_PATH=${DTK_BINARY_DIR}/lib/dtk:${DTK_BINARY_DIR}/lib/dtkFLTK:${DTK_BINARY_DIR}/lib/dtkGLX:${DTK_BINARY_DIR}/lib/dtkX11:${DTK_BINARY_DIR}/server && ./${PROG_HELP_SCRIPT} html/listProgramsHelp.html COMMAND export LD_LIBRARY_PATH=${LD_LIBRARY_PATH_SAVE})
	ENDIF (DTK_ARCH_UPPER MATCHES "WIN32_VCPP")
	ADD_DEPENDENCIES (doc_programs ${DTK_DOC_DEPENDS})

	IF (DTK_ARCH_UPPER MATCHES "WIN32_VCPP")
		ADD_CUSTOM_TARGET (doc_installation ALL COMMAND ${INSTALLATION_SCRIPT} html\\installation.html)
	ELSE (DTK_ARCH_UPPER MATCHES "WIN32_VCPP")
		ADD_CUSTOM_TARGET (doc_installation ALL COMMAND ./${INSTALLATION_SCRIPT} html/installation.html)
	ENDIF (DTK_ARCH_UPPER MATCHES "WIN32_VCPP")


	INSTALL (FILES ${DTK_DOXYGEN_OUTPUT_PATH}/dtk.tag DESTINATION doc)
	INSTALL (DIRECTORY ${DTK_DOXYGEN_OUTPUT_PATH}/man
		DESTINATION .)
	INSTALL (DIRECTORY ${DTK_DOXYGEN_OUTPUT_PATH}/html
		DESTINATION doc/dtk)
	INSTALL (DIRECTORY ${DTK_SOURCE_DIR}/doc/
		DESTINATION doc/dtk/html
		REGEX ".png"
		REGEX ".svn" EXCLUDE
		REGEX ".in" EXCLUDE
		REGEX ".sh" EXCLUDE
		REGEX ".bat" EXCLUDE
		REGEX ".txt" EXCLUDE
		REGEX ".swp" EXCLUDE)

	IF (DOXYGEN_EXECUTABLE)
		SET (DOXYFILE_FILE "${DTK_BINARY_DIR}/doc/Doxyfile")
		IF (WIN32)
			STRING (REPLACE "/" "\\\\" DOXYFILE_FILE "${DOXYFILE_FILE}")
		ENDIF (WIN32)
		ADD_CUSTOM_TARGET (doxygen_docs ALL COMMAND ${DOXYGEN_EXECUTABLE}
			"${DOXYFILE_FILE}")
	ENDIF (DOXYGEN_EXECUTABLE)
ENDIF (DTK_BUILD_DOCUMENTATION)

