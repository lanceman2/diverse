REM Change echo to off after testing
@echo off
if "%1" EQU "" (
	echo "Usage: %0 OUTFILE"
	exit 1
)

set fullfile=%1
echo "%fullfile%"

set count=0

for /R ..\config %%i in (dtk-*.exe) do (
	set /a count+=1
)
for /R ..\programs %%i in (dtk-*.exe) do (
	set /a count+=1
)
for /R ..\server %%i in (dtk-*.exe) do (
	set /a count+=1
)

echo ^<html^> > %fullfile%
echo ^<head^> >> %fullfile%
echo ^<title^>Help for All DTK Programs^</title^> >> %fullfile%
echo ^</head^> >> %fullfile%
echo ^<body^> >> %fullfile%
echo ^<center^> >> %fullfile%
echo ^<h2^>Help for All DTK Programs^</h2^> >> %fullfile%
echo ^</center^> >> %fullfile%
echo Here we list the output of the '--help' (or '-h') for >> %fullfile%
echo %count% DTK programs.^&nbsp^;  Note: some of this output depends on where DTK >> %fullfile%
echo programs are installed when this page was generated.^&nbsp^;  This document >> %fullfile%
echo was generated by running all these DTK programs on a @CMAKE_SYSTEM_NAME@ system using >> %fullfile%
..\config\dtk-config --version > version.tmp
set /p version= < version.tmp
del version.tmp
..\config\dtk-config --date > dtkdate.tmp
set /p dtkdate= < dtkdate.tmp
del dtkdate.tmp
echo DTK version %version%, %dtkdate%. >> %fullfile%
echo ^<p^> >> %fullfile%
echo All of these programs are Licensed >> %fullfile%
echo under the GNU General Public License, except for dtk-server which is >> %fullfile%
echo Licensed under the GNU Lesser General Public License. >> %fullfile%
echo See: http://www.gnu.org/copyleft/. >> %fullfile%
echo ^<p^> >> %fullfile%

for /R ..\config %%i in (dtk-*.exe) do if %%i neq "" (
	echo ^<hr^> >> %fullfile%
	echo output of: ^<b^>%%~ni --help^</b^> >> %fullfile%
	echo ^<p^> >> %fullfile%
	echo ^<pre^> >> %fullfile%
	echo running %%~ni --help
	%%~fi --help > programhelp.temp
	type programhelp.temp >> %fullfile%
	del programhelp.temp
	echo ^</pre^> >> %fullfile%
)
for /R ..\programs %%i in (dtk-*.exe) do if %%i neq "" (
	echo ^<hr^> >> %fullfile%
	echo output of: ^<b^>%%~ni --help^</b^> >> %fullfile%
	echo ^<p^> >> %fullfile%
	echo ^<pre^> >> %fullfile%
	echo running %%~ni --help
	%%~fi --help > programhelp.temp
	type programhelp.temp >> %fullfile%
	del programhelp.temp
	echo ^</pre^> >> %fullfile%
)
for /R ..\server %%i in (dtk-*.exe) do if %%i neq "" (
	echo ^<hr^> >> %fullfile%
	echo output of: ^<b^>%%~ni --help^</b^> >> %fullfile%
	echo ^<p^> >> %fullfile%
	echo ^<pre^> >> %fullfile%
	echo running %%~ni --help >> %fullfile%
	%%~fi --help > programhelp.temp
	type programhelp.temp >> %fullfile%
	del programhelp.temp
	echo ^</pre^> >> %fullfile%
)

echo ^<p^> >> %fullfile%

type footer.html >> %fullfile%

echo "made %1 from the output of the ----- %count% DTK programs ------"
